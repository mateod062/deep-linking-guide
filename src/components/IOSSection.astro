---
import { Prism } from '@astrojs/prism';
---

<section id="ios" class="mb-16" data-aos="fade-up">
  <div class="bg-white rounded-xl shadow-lg p-8">
    <div class="flex items-center mb-6">
      <div class="w-12 h-12 bg-gray-900 rounded-lg flex items-center justify-center mr-4">
        <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
        </svg>
      </div>
      <h2 class="text-3xl font-bold text-gray-900">iOS Universal Links</h2>
    </div>

    <div class="bg-gradient-to-r from-asee-light to-gray-50 border border-asee-blue rounded-lg p-6 my-8">
      <h3 class="flex items-center text-lg font-semibold text-gray-900 mb-4">
        <span class="material-symbols-outlined mr-2">
          overview
        </span>
        Overview
      </h3>
      <div>
        <ul class="space-y-2 text-sm text-asee-dark">
        <li class="flex items-start">
          <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
          <span>Enable Associated Domains</span>
        </li>
        <li class="flex items-start">
          <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
          <span>Create AASA file</span>
        </li>
        <li class="flex items-start">
          <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
          <span>Host at <code>/.well-known/</code></span>
        </li>
        <li class="flex items-start">
          <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
          <span>Handle in <code>AppDelegate</code></span>
        </li>
        </ul>
      </div>
    </div>

    <div class="prose prose-lg max-w-none">
      <p class="text-gray-700 mb-6">
        iOS Universal Links use an Apple App Site Association (AASA) file to securely associate URLs with your app. When users tap a Universal Link, iOS checks if your app is installed and opens it directly to the specific content.
      </p>

      <h3 class="text-xl font-semibold text-gray-900 mb-4">Implementation Steps</h3>
      
      <div class="space-y-6">
        <div class="bg-gray-50 rounded-lg p-6">
          <h4 class="font-semibold text-gray-900 mb-3">1. Configure App ID in Apple Developer Portal</h4>
          <p class="text-gray-700 mb-4">Before enabling Associated Domains in Xcode, you must first configure your App ID in the Apple Developer Portal with the Associated Domains capability.</p>
          
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
            <h5 class="font-semibold text-blue-900 mb-2">App ID Requirements:</h5>
            <ul class="space-y-2 text-blue-800 text-sm">
              <li class="flex items-start">
                <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
                <div class="min-w-0">
                  Use explicit App ID (e.g., <code class="bg-blue-100 px-2 py-1 rounded text-xs break-all">com.example.myapp</code>)
                </div>
              </li>
              <li class="flex items-start">
                <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
                <div class="min-w-0">
                  Don't use wildcard App IDs (e.g., <code class="bg-blue-100 px-2 py-1 rounded text-xs break-all">com.example.*</code>) for Associated Domains
                </div>
              </li>
              <li class="flex items-start">
                <div class="w-2 h-2 bg-asee-blue rounded-full mt-2 mr-3 flex-shrink-0"></div>
                <div class="min-w-0">
                  Associated Domains must be enabled in the App ID configuration
                </div>
              </li>
            </ul>
          </div>
          
          <div class="space-y-3">
            <div class="flex items-start">
              <span class="inline-flex items-center justify-center w-6 h-6 bg-blue-600 text-white text-xs font-bold rounded-full mr-3 mt-0.5 flex-shrink-0">1</span>
              <p class="text-gray-700">Go to <a href="https://developer.apple.com/account/resources/identifiers/list" class="text-blue-600 underline hover:text-asee-blue hover:scale-105 transition-all duration-200 transform cursor-pointer">Apple Developer Portal → Certificates, Identifiers & Profiles → Identifiers</a></p>
            </div>
            <div class="flex items-start">
              <span class="inline-flex items-center justify-center w-6 h-6 bg-blue-600 text-white text-xs font-bold rounded-full mr-3 mt-0.5 flex-shrink-0">2</span>
              <p class="text-gray-700">Select your App ID or create a new one with an explicit Bundle ID (no wildcards)</p>
            </div>
            <div class="flex items-start">
              <span class="inline-flex items-center justify-center w-6 h-6 bg-blue-600 text-white text-xs font-bold rounded-full mr-3 mt-0.5 flex-shrink-0">3</span>
              <p class="text-gray-700">In the Capabilities section, enable <strong>Associated Domains</strong></p>
            </div>
            <div class="flex items-start">
              <span class="inline-flex items-center justify-center w-6 h-6 bg-blue-600 text-white text-xs font-bold rounded-full mr-3 mt-0.5 flex-shrink-0">4</span>
              <p class="text-gray-700">Save the configuration and regenerate your provisioning profiles</p>
            </div>
          </div>
          
          <div class="space-y-6 mt-6 mb-6">
            <div class="text-center">
              <div class="bg-white rounded-lg border border-gray-200 p-4 mb-3 hover:shadow-md transition-shadow max-w-2xl mx-auto">
                <img src="/assets/images/identifiers.png" 
                     alt="Identifiers section in Apple Developer Portal" 
                     class="w-full h-auto rounded shadow-sm"
                     loading="lazy">
              </div>
              <p class="text-sm text-gray-600 font-medium">Step 1.1: Navigate to Identifiers in Developer Portal</p>
            </div>
            
            <div class="text-center">
              <div class="bg-white rounded-lg border border-gray-200 p-4 mb-3 hover:shadow-md transition-shadow max-w-2xl mx-auto">
                <img src="/assets/images/register_app_id.png" 
                     alt="Register App ID configuration" 
                     class="w-full h-auto rounded shadow-sm"
                     loading="lazy">
              </div>
              <p class="text-sm text-gray-600 font-medium">Step 1.2: Register App ID with Associated Domains capability</p>
            </div>
          </div>
          
          <div class="bg-asee-light border border-asee-blue rounded-lg p-4 mt-4">
            <p class="text-asee-dark text-sm">
              <strong>Important:</strong> After enabling Associated Domains for your App ID, you must regenerate and download your provisioning profiles in Xcode or the Developer Portal.
            </p>
          </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-6">
          <h4 class="font-semibold text-gray-900 mb-3">2. Enable Associated Domains in Xcode</h4>
          <p class="text-gray-700">
            In Xcode, go to your app target → Signing & Capabilities → Add Capability → Associated Domains.
          </p>
          <div class="mt-3 mb-4">
            <span class="block text-gray-700 mb-2">Add:</span>
            <code class="bg-gray-200 px-2 py-1 rounded text-sm break-all">applinks:yourdomain.com</code>
          </div>
          
          <div class="space-y-6 mb-6">
            <div class="text-center">
              <div class="bg-white rounded-lg border border-gray-200 p-4 mb-3 hover:shadow-md transition-shadow max-w-2xl mx-auto">
                <img src="/assets/images/capabilities_button.png" 
                     alt="Signing & Capabilities button in Xcode" 
                     class="w-full h-auto rounded shadow-sm"
                     loading="lazy">
              </div>
              <p class="text-sm text-gray-600 font-medium">Step 2.1: Click Signing & Capabilities</p>
            </div>
            
            <div class="text-center">
              <div class="bg-white rounded-lg border border-gray-200 p-4 mb-3 hover:shadow-md transition-shadow max-w-2xl mx-auto">
                <img src="/assets/images/capabilities_menu.png" 
                     alt="Add Capability menu in Xcode" 
                     class="w-full h-auto rounded shadow-sm"
                     loading="lazy">
              </div>
              <p class="text-sm text-gray-600 font-medium">Step 2.2: Add Capability → Associated Domains</p>
            </div>
            
            <div class="text-center">
              <div class="bg-white rounded-lg border border-gray-200 p-4 mb-3 hover:shadow-md transition-shadow max-w-2xl mx-auto">
                <img src="/assets/images/associated_domains.png" 
                     alt="Associated Domains configuration in Xcode" 
                     class="w-full h-auto rounded shadow-sm"
                     loading="lazy">
              </div>
              <p class="text-sm text-gray-600 font-medium">Step 2.3: Configure Associated Domains</p>
            </div>
          </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-6">
          <h4 class="font-semibold text-gray-900 mb-3">3. Create AASA File</h4>
          <div class="mb-3">
            <span class="block text-gray-700 mb-2">
              Create an <code class="bg-gray-200 px-2 py-1 rounded text-sm break-all">apple-app-site-association</code> file (no extension) with your app details.
              The <code class="bg-gray-200 px-2 py-1 rounded text-sm break-all">TEAMID</code> and <code class="bg-gray-200 px-2 py-1 rounded text-sm break-all">BUNDLEID</code> values can be found in your <a href="https://developer.apple.com/account/resources/identifiers/list" class="text-blue-600 underline hover:text-asee-blue hover:scale-105 transition-all duration-200 transform cursor-pointer">Apple Developer Console</a>.
            </span>
          </div>
          <div class="code-block">
            <Prism lang="json" code={`{
  "applinks": {
    "apps": [],
    "details": [
      {
        "appID": "<TEAMID>.<BUNDLEID>",
        "paths": [
          "/products/*",
          "/help",
          "/profile/*",
          "/orders/*"
        ]
      }
    ]
  }
}`} />
          </div>
          <div class="bg-asee-light border-l-4 border-asee-blue p-6 my-8">
            <h3 class="flex items-center text-lg font-semibold text-asee-dark mb-2">How to configure the "paths"</h3>
            <p class="mb-3">The <code class="bg-gray-200 px-1 py-0.5 rounded">paths</code> array specifies which parts of your website should be handled by your app as Universal Links. The system matches incoming URL paths against this list from top to bottom.</p>
            <ul class="list-disc list-inside space-y-2">
              <li>
                Use the asteriskas a wildcard to match any sequence of characters. For example, <code class="bg-gray-200 px-1 py-0.5 rounded">"/products/*"</code> will match <code class="bg-gray-200 px-1 py-0.5 rounded">/products/123</code> and <code class="bg-gray-200 px-1 py-0.5 rounded">/products/new-item-name</code>.
              </li>
              <li>
                Use a question mark to match any single character. For example, <code class="bg-gray-200 px-1 py-0.5 rounded">"/item/?"</code> would match <code class="bg-gray-200 px-1 py-0.5 rounded">/item/a</code> but not <code class="bg-gray-200 px-1 py-0.5 rounded">/item/ab</code>.
              </li>
              <li>
                Paths without wildcards, like <code class="bg-gray-200 px-1 py-0.5 rounded">"/help"</code>, will only match that exact URL path.
              </li>
              <li>
                You can prevent certain paths from opening your app by prepending <code class="bg-gray-200 px-1 py-0.5 rounded">"NOT "</code> (with a space). For instance, to handle all product URLs except for a specific admin section, you could use: <code class="bg-gray-200 px-1 py-0.5 rounded">["NOT /products/admin/*", "/products/*"]</code>. The order is important here; the exclusion must come before the broader inclusion.
              </li>
            </ul>
          </div>
          <div class="bg-asee-light border border-asee-blue rounded-lg p-4 mt-4">
              <p class="text-asee-dark text-sm">
                <strong>Important:</strong> Path matching is case-sensitive, and it only applies to the path component of the URL, not the query parameters or fragments.
              </p>
            </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-6">
          <h4 class="font-semibold text-gray-900 mb-3">4. Handle Links in App</h4>
          <p class="text-gray-700 mb-3">Implement the Universal Link handler in your AppDelegate:</p>
          <div class="code-block">
            <Prism lang="swift" code={`func application(_ application: UIApplication, 
                continue userActivity: NSUserActivity,
                restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
    
    guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
          let incomingURL = userActivity.webpageURL 
    else {
        return false
    }
    
    // Parse the URL and navigate to appropriate screen
    handleUniversalLink(url: incomingURL)
    return true
}

private func handleUniversalLink(url: URL) {
    let path = url.path
    
    if path.hasPrefix("/products/") {
        let productId = path.replacingOccurrences(of: "/products/", with: "")
        // Navigate to product detail screen
        navigateToProduct(id: productId)
    } else if path == "/profile" {
        // Navigate to profile screen
        navigateToProfile()
    }
}`} />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>